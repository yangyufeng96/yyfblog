<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>⼤⼚⾯试章法 | 峰享会</title>
  
  <meta name="keywords" content="前端开发,科技,数据可视化,移动开发,小程序,客户端">
  
  
  <meta name="description" content="集合了开发技能，生活趣事，未来科技，情感互动于一体。">
  

  
  <link rel="alternate" href="/./atom.xml" title="峰享会">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  
  
  <meta name="theme-color" content="#FFFFFF">
  <meta name="msapplication-TileColor" content="#1BC3FB">
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  
  
  <link rel="shortcut icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/img/favicon.ico">
  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/css/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover post half'>
      
        
  <h1 class='title'>漫道求索</h1>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder="这里有你知道的一切" />
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-home fa-fw'></i>&nbsp;主页
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/blogpost/categories/"
            
              rel="nofollow"
            
            
            id="blogpostcategories">
            <i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/blogpost/tags/"
            
              rel="nofollow"
            
            
            id="blogposttags">
            <i class='fas fa-hashtag fa-fw'></i>&nbsp;标签
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/blogpost/archives/"
            
              rel="nofollow"
            
            
            id="blogpostarchives">
            <i class='fas fa-archive fa-fw'></i>&nbsp;归档
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/friends/"
            
              rel="nofollow"
            
            
            id="friends">
            <i class='fas fa-user-friends fa-fw'></i>&nbsp;朋友
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/"
            
              rel="nofollow"
            
            
            id="about">
            <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header material">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="material"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          峰享会
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-home fa-fw'></i>&nbsp;主页
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/blogpost/categories/"
                  
                    rel="nofollow"
                  
                  
                  id="blogpostcategories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/blogpost/tags/"
                  
                    rel="nofollow"
                  
                  
                  id="blogposttags">
									<i class='fas fa-hashtag fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/blogpost/archives/"
                  
                    rel="nofollow"
                  
                  
                  id="blogpostarchives">
									<i class='fas fa-archive fa-fw'></i>&nbsp;归档
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/friends/"
                  
                    rel="nofollow"
                  
                  
                  id="friends">
									<i class='fas fa-user-friends fa-fw'></i>&nbsp;朋友
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/about/"
                  
                    rel="nofollow"
                  
                  
                  id="about">
									<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索" />
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-clock fa-fw'></i>&nbsp;所有文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/blogpost/archives/"
                
                  rel="nofollow"
                
                
                id="blogpostarchives">
								<i class='fas fa-archive fa-fw'></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/blogpost/tags/"
                
                  rel="nofollow"
                
                
                id="blogposttags">
								<i class='fas fa-hashtag fa-fw'></i>&nbsp;所有标签
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/friends/"
                
                  rel="nofollow"
                
                
                id="friends">
								<i class='fas fa-link fa-fw'></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/./atom.xml"
                
                  rel="nofollow"
                
                
                id=".atom.xml">
								<i class='fas fa-rss fa-fw'></i>&nbsp;RSS订阅
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/"
                
                  rel="nofollow"
                
                
                id="about">
								<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于博主
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>

  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main'>
  

  
    <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/posts/37eb3f8a.html">
        ⼤⼚⾯试章法
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="https://yangyfeng.github.io" rel="nofollow">
      
        <img src="https://s2.ax1x.com/2019/07/12/Zhm4jf.jpg">
      
      <p>漫道求索</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-11-16</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/blogpost/categories/前端/' rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>前端</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class='notlink'>
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
        
          <!-- 文章字体个数 -->
          <div class="new-meta-item size">
            <a class="notlink">
              <i class="fas fa-edit" aria-hidden="true"></i>
              <p>2.3k字</p>
            </a>
          </div>
          <!-- 阅读时间 -->
          <div class="new-meta-item read-time">
            <a class="notlink">
              <i class="fas fa-desktop" aria-hidden="true"></i>
              <p>11分</p>
            </a>
          </div>
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          <h2 id="简历"><a href="#简历" class="headerlink" title="简历"></a>简历</h2><p>2⻚以内，简历有点类似相亲的介绍，⼩时候拿过三好学</p>
<p>⽣就别说了，就像别写你会html+css，别写你⽤vue做 </p>
<p>过todolist⼀样</p>
<p>突出⾃⼰的技术亮点</p>
<p>别瞎写精通</p>
<p>markdown就好，别⽤word</p>
<p>突出亮点！</p>
<h2 id="⽬标公司"><a href="#⽬标公司" class="headerlink" title="⽬标公司"></a>⽬标公司</h2><p>天眼查，脉脉，知乎</p>
<h2 id="如何描述做过的项⽬"><a href="#如何描述做过的项⽬" class="headerlink" title="如何描述做过的项⽬"></a>如何描述做过的项⽬</h2><ol>
<li><p>做过的明星项⽬</p>
</li>
<li><p>项⽬技术栈和细节</p>
</li>
<li><p>源码深度</p>
</li>
<li><p>优化，性能，体验，极客</p>
</li>
<li><p>填坑</p>
</li>
<li><p>成⻓</p>
</li>
</ol>
<h2 id="⾯试技巧合计"><a href="#⾯试技巧合计" class="headerlink" title="⾯试技巧合计"></a>⾯试技巧合计</h2><ol>
<li><p>认识⾃⼰（市场）</p>
</li>
<li><p>阐述优势</p>
</li>
<li><p>谈判得来的 都是纯利润</p>
</li>
<li><p>hr细节(考勤，补贴，996，五险⼀⾦，补贴</p>
</li>
<li>⼀个⾯试题的精讲</li>
</ol>
<h2 id="精讲面试题之前端⽂件上传"><a href="#精讲面试题之前端⽂件上传" class="headerlink" title="精讲面试题之前端⽂件上传"></a>精讲面试题之前端⽂件上传</h2><p><strong>1、原理概述</strong></p>
<p>考察全栈思维，http协议 ，node⽂件处理</p>
<p>我⽤vue+element+nodejs来演示</p>
<p>基本答案 （<strong>10K</strong>）</p>
<a id="more"></a>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">formData</span><br><span class="line">&lt;input <span class="class"><span class="keyword">type</span></span>=<span class="string">"file"</span> <span class="meta">@change</span>=<span class="string">"handleFileChange"</span> /&gt;</span><br><span class="line">&lt;el-button <span class="class"><span class="keyword">type</span></span>=<span class="string">"primary"</span> <span class="meta">@click</span>=<span class="string">"handleUpload"</span>&gt;上传&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">js</span><br><span class="line">handleFileChange(<span class="keyword">e</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [<span class="keyword">file</span>] = <span class="keyword">e</span>.target.files; </span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">file</span>) <span class="keyword">return</span>; </span><br><span class="line">  <span class="keyword">form</span>.<span class="keyword">append</span>(<span class="string">"filename"</span>, this.container.<span class="keyword">file</span>.name);</span><br><span class="line">  <span class="keyword">form</span>.<span class="keyword">append</span>(<span class="string">"file"</span>, this.container.<span class="keyword">file</span>);</span><br><span class="line"> 	request(&#123;url: '/upload', 9 data: <span class="keyword">form</span>&#125;)</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">node</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">'./controller'</span>)</span><br><span class="line"><span class="keyword">const</span> schedule = <span class="built_in">require</span>(<span class="string">'./schedule'</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.createServer()</span><br><span class="line"><span class="keyword">const</span> UPLOAD_DIR = path.resolve(__dirname, <span class="string">".."</span>, <span class="string">"target"</span>); <span class="comment">// ⼤⽂件存储⽬录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// schedule.start(UPLOAD_DIR)</span></span><br><span class="line"> <span class="keyword">const</span> ctrl = <span class="keyword">new</span> Controller(UPLOAD_DIR)</span><br><span class="line"> server.on(<span class="string">"request"</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">   res.setHeader(<span class="string">"Access-Control-AllowOrigin"</span>, <span class="string">"*"</span>)</span><br><span class="line">   res.setHeader(<span class="string">"Access-Control-AllowHeaders"</span>, <span class="string">"*"</span>)</span><br><span class="line">   <span class="keyword">if</span> (req.method === <span class="string">"OPTIONS"</span>) &#123;</span><br><span class="line">     res.status = <span class="number">200</span></span><br><span class="line">     res.end()</span><br><span class="line">     <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (req.method === <span class="string">"POST"</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span> (req.url == <span class="string">'/upload'</span>) &#123;</span><br><span class="line">       <span class="keyword">await</span> ctrl.handleUpload(req, res)</span><br><span class="line">       <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> </span><br><span class="line"> server.listen(<span class="number">3000</span>, <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"正在监听 3000 端⼝"</span>))</span><br><span class="line"> </span><br><span class="line"> Controller.js</span><br><span class="line"> <span class="keyword">async</span> handleUpload(req, res) &#123;</span><br><span class="line">   <span class="keyword">const</span> multipart = <span class="keyword">new</span> multiparty.Form()</span><br><span class="line">   multipart.parse(req, <span class="keyword">async</span> (err,</span><br><span class="line">     field, file) =&gt; &#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="built_in">console</span>.log(err) <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">const</span> [chunk] = file.file</span><br><span class="line">     <span class="keyword">const</span> [filename] = field.filename</span><br><span class="line">     <span class="keyword">const</span> filePath = path.resolve(<span class="keyword">this</span>.UPLOAD_DIR, <span class="string">`<span class="subst">$&#123;fileHash&#125;</span><span class="subst">$&#123;extractExt(filename)&#125;</span>`</span>)</span><br><span class="line">     <span class="keyword">const</span> chunkDir = path.resolve(<span class="keyword">this</span>.UPLOAD_DIR, fileHash)</span><br><span class="line">     <span class="comment">// ⽂件存在直接返回</span></span><br><span class="line">     <span class="keyword">if</span> (fse.existsSync(filePath)) &#123;</span><br><span class="line">       res.end(<span class="string">"file exist"</span>)</span><br><span class="line">       <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (!fse.existsSync(chunkDir)) &#123;</span><br><span class="line">       <span class="keyword">await</span> fse.mkdirs(chunkDir)</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">await</span> fse.move(chunk.path, <span class="string">`<span class="subst">$&#123;chunkDir&#125;</span>/<span class="subst">$&#123;hash&#125;</span>`</span>)</span><br><span class="line">     res.end(<span class="string">"received file chunk"</span>)</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>总结：</p>
<ol>
<li><p>formData</p>
</li>
<li><p>httpserver</p>
</li>
<li><p>fs⽂件处理</p>
</li>
<li><p>multiparty解析post数据</p>
</li>
</ol>
<p><strong>加分项-拖拽，粘贴</strong></p>
<p>考点: 拖拽事件drop，clipboardData</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"drop-box"</span> id=<span class="string">"drop-box"</span>&gt;</span><br><span class="line"><span class="comment">// 拖拽</span></span><br><span class="line">box.addEventListener(<span class="string">"drop"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault(); <span class="comment">//取消浏览器默认拖拽效果</span></span><br><span class="line">    <span class="keyword">var</span> fileList = e.dataTransfer.files; <span class="comment">//获取拖拽中的⽂件对象 </span></span><br><span class="line">    <span class="keyword">var</span> len = fileList.length; <span class="comment">//⽤来获取⽂件的⻓度（其实是获得⽂件数量）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [file] = e.target.files;</span><br><span class="line">    <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  ...上传</span></span><br><span class="line"></span><br><span class="line"> &#125;, <span class="literal">false</span>)</span><br><span class="line"><span class="comment">// 粘贴 </span></span><br><span class="line"> box.addEventListener(<span class="string">'paste'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = (event.clipboardData)</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>
<p><strong>⼤⽂件上传(20K)</strong></p>
<p>blob.slice分⽚ 思想+语法</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const chunks = <span class="keyword">this</span>.createFileChunk(<span class="keyword">this</span>.container.<span class="keyword">file</span>);</span><br><span class="line">createFileChunk(<span class="keyword">file</span>, <span class="keyword">size</span> = <span class="keyword">SIZE</span>) &#123; <span class="comment">// ⽣成⽂件块</span></span><br><span class="line">    const chunks = [];</span><br><span class="line">    let cur = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (cur &lt; <span class="keyword">file</span>.<span class="keyword">size</span>) &#123;</span><br><span class="line">      chunks.<span class="keyword">push</span>(&#123;</span><br><span class="line">        <span class="keyword">file</span>: <span class="keyword">file</span>.slice(cur, cur + <span class="keyword">size</span>)</span><br><span class="line">      &#125;);</span><br><span class="line">      cur += <span class="keyword">size</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> chunks;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>所有切⽚挨个发请求，然后merge</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> handleMerge(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> resolvePost(req)</span><br><span class="line">    <span class="title">const</span> &#123;</span><br><span class="line">      fileHash,</span><br><span class="line">      filename,</span><br><span class="line">      <span class="built_in">size</span></span><br><span class="line">    &#125; = data</span><br><span class="line">    <span class="keyword">const</span> ext = extractExt(filename)</span><br><span class="line">    <span class="keyword">const</span> filePath =</span><br><span class="line">      path.resolve(<span class="keyword">this</span>.UPLOAD_DIR, <span class="string">`<span class="subst">$&#123;fileHash&#125;</span><span class="subst">$&#123;ext&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.mergeFileChunk(filePath, fileHash, <span class="built_in">size</span>)</span><br><span class="line">    res.end(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">      <span class="attribute">code</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attribute">message</span>: <span class="string">"file merged success"</span></span><br><span class="line">    &#125;))</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>断点续传+秒传</strong></p>
<p>md5计算，缓存思想 ⽂件⽤md5计算⼀个指纹，上传之前，先问后端，这个⽂件的hash在不在，在的话就不⽤传了，就是所谓的断点续传，如果整个⽂件都存在了 就是秒传</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> handleVerify(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> resolvePost(req)</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      filename,</span><br><span class="line">      hash</span><br><span class="line">    &#125; = data</span><br><span class="line">    <span class="keyword">const</span> ext = extractExt(filename)</span><br><span class="line">    <span class="keyword">const</span> filePath = path.resolve(<span class="keyword">this</span>.UPLOAD_DIR, <span class="string">`<span class="subst">$&#123;hash&#125;</span><span class="subst">$&#123;ext&#125;</span>`</span>)</span><br><span class="line">    <span class="comment">// ⽂件是否存在</span></span><br><span class="line">    <span class="keyword">let</span> uploaded = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">let</span> uploadedList = []</span><br><span class="line">    <span class="keyword">if</span> (fse.existsSync(filePath)) &#123;</span><br><span class="line">      uploaded = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ⽂件没有完全上传完毕，但是可能存在部分切⽚上传完毕了</span></span><br><span class="line">      uploadedList = <span class="keyword">await</span> getUploadedList(path.resolve(<span class="keyword">this</span>.UPLOAD_DIR, hash))</span><br><span class="line">    &#125;</span><br><span class="line">    res.end(</span><br><span class="line">      <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        uploaded,</span><br><span class="line">        uploadedList <span class="comment">// 过滤诡异的隐藏⽂件</span></span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>计算hash优化(25+)</strong></p>
<p>1、<strong>web-worker</strong></p>
<p>⼤⽂件的md5太慢了,启⽤webworker计算</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// web-worker</span></span><br><span class="line">  <span class="keyword">self</span>.importScripts(<span class="string">'spark-md5.min.js'</span>)</span><br><span class="line">  <span class="keyword">self</span>.onmessage = e =&gt; &#123;</span><br><span class="line">    <span class="comment">// 接受主线程的通知</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      chunks</span><br><span class="line">    &#125; = e.data</span><br><span class="line">    <span class="keyword">const</span> spark = <span class="keyword">new</span></span><br><span class="line">    <span class="keyword">self</span>.SparkMD5.ArrayBuffer()</span><br><span class="line">    <span class="keyword">let</span> progress = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">const</span> loadNext = index =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader()</span><br><span class="line">      reader.readAsArrayBuffer(chunks[index].file)</span><br><span class="line">      reader.onload = e =&gt; &#123;</span><br><span class="line">        <span class="comment">// 累加器 不能依赖index，</span></span><br><span class="line">        count++</span><br><span class="line">        <span class="comment">// 增量计算md5</span></span><br><span class="line">        spark.append(e.target.result)</span><br><span class="line">        <span class="keyword">if</span> (count === chunks.length) &#123;</span><br><span class="line">          <span class="comment">// 通知主线程，计算结束</span></span><br><span class="line">          <span class="keyword">self</span>.postMessage(&#123;</span><br><span class="line">            progress: <span class="number">100</span>,</span><br><span class="line">            hash: spark.end()</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 每个区块计算结束，通知进度即可</span></span><br><span class="line">          progress += <span class="number">100</span> / chunks.length</span><br><span class="line">          <span class="keyword">self</span>.postMessage(&#123;</span><br><span class="line">            progress</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="comment">// 计算下⼀个</span></span><br><span class="line">          loadNext(count)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 启动</span></span><br><span class="line">    loadNext(<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>1、<strong>time-slice(30+)</strong></p>
<p>react fifiber架构学习，利⽤浏览器空闲时间</p>
<p>requestIdleCallback</p>
<p><a href="https://imgchr.com/i/DweIhj" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/img/loading.gif" data-original="https://s3.ax1x.com/2020/11/26/DweIhj.png" alt="DweIhj.png"></a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">requestIdelCallback(myNonEssentialWork);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">myNonEssentialWork</span>(<span class="params">deadline</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// deadline.timeRemaining()可以获取到当前帧剩余时间</span></span><br><span class="line">    <span class="comment">// 当前帧还有时间 并且任务队列不为空</span></span><br><span class="line">    <span class="keyword">while</span> (deadline.timeRemaining() &gt; <span class="number">0</span> &amp;&amp; tasks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      doWorkIfNeeded();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tasks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      requestIdleCallback(myNonEssentialWork);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> calculateHashIdle(chunks) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> spark = <span class="keyword">new</span></span><br><span class="line">      SparkMD5.ArrayBuffer();</span><br><span class="line">      <span class="keyword">let</span> count = <span class="number">0</span>; <span class="comment">// 根据⽂件内容追加计算</span></span><br><span class="line">      <span class="keyword">const</span> appendToSpark = <span class="keyword">async</span></span><br><span class="line">      file =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> reader = <span class="keyword">new</span></span><br><span class="line">          FileReader();</span><br><span class="line"></span><br><span class="line">          reader.readAsArrayBuffer(file);</span><br><span class="line">          reader.onload = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">            spark.append(e.target.result);</span><br><span class="line">            resolve();</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">const</span> workLoop = <span class="keyword">async</span> deadline =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 有任务，并且当前帧还没结束</span></span><br><span class="line">        <span class="keyword">while</span> (count &lt; chunks.length &amp;&amp;</span><br><span class="line">          deadline.timeRemaining() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">await</span></span><br><span class="line">          appendToSpark(chunks[count].file);</span><br><span class="line">          count++;</span><br><span class="line">          <span class="comment">// 没有了 计算完毕</span></span><br><span class="line">          <span class="keyword">if</span> (count &lt; chunks.length) &#123;</span><br><span class="line">            <span class="comment">// 计算中</span></span><br><span class="line">            <span class="keyword">this</span>.hashProgress =</span><br><span class="line">              <span class="built_in">Number</span>(</span><br><span class="line">                ((<span class="number">100</span> * count) /</span><br><span class="line">                  chunks.length).toFixed(<span class="number">2</span>)</span><br><span class="line">              );</span><br><span class="line"></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.hashProgress)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 计算完毕</span></span><br><span class="line">            <span class="keyword">this</span>.hashProgress = <span class="number">100</span>;</span><br><span class="line">            resolve(spark.end());</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">window</span>.requestIdleCallback(workLoop);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>3、<strong>算法优化</strong></p>
<h2 id="精讲面试题之请求并发数控制和重试"><a href="#精讲面试题之请求并发数控制和重试" class="headerlink" title="精讲面试题之请求并发数控制和重试"></a>精讲面试题之请求并发数控制和重试</h2><p><a href="https://imgchr.com/i/DwmGVS" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/img/loading.gif" data-original="https://s3.ax1x.com/2020/11/26/DwmGVS.png" alt="DwmGVS.png"></a></p>
<p>1、<strong>基本实现</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> sendRequest(forms, max = <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> len = forms.length;</span><br><span class="line">      <span class="keyword">let</span> idx = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">let</span> counter = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">const</span> start = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// 有请求，有通道</span></span><br><span class="line">        <span class="keyword">while</span> (idx &lt; len &amp;&amp; max &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          max--; <span class="comment">// 占⽤通道</span></span><br><span class="line">          <span class="built_in">console</span>.log(idx, <span class="string">"start"</span>);</span><br><span class="line">          <span class="keyword">const</span> form = forms[idx].form;</span><br><span class="line">          <span class="keyword">const</span> index =</span><br><span class="line">            forms[idx].index; + idx++</span><br><span class="line">          request(&#123;</span><br><span class="line">            url: <span class="string">'/upload'</span>,</span><br><span class="line">            data: form,</span><br><span class="line">            onProgress: <span class="keyword">this</span>.createProgresshandler(<span class="keyword">this</span>.chunks[</span><br><span class="line">              index]),</span><br><span class="line">            requestList: <span class="keyword">this</span>.requestList</span><br><span class="line">          &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            max++; <span class="comment">// 释放通道</span></span><br><span class="line">            counter++;</span><br><span class="line">            <span class="keyword">if</span> (counter === len) &#123;</span><br><span class="line">              resolve();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              start();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      start();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> uploadChunks(uploadedList = []) &#123;</span><br><span class="line">    <span class="comment">// 这⾥⼀起上传，碰⻅⼤⽂件就是灾难</span></span><br><span class="line">    <span class="comment">// 没被hash计算打到，被⼀次性的tcp链接把浏览器稿挂了</span></span><br><span class="line">    <span class="comment">// 异步并发控制策略，我记得这个也是头条⼀个⾯试题</span></span><br><span class="line">    <span class="comment">// ⽐如并发量控制成4</span></span><br><span class="line">    <span class="keyword">const</span> list = <span class="keyword">this</span>.chunks.filter(<span class="function"><span class="params">chunk</span> =&gt;</span> uploadedList.indexOf(chunk.hash) == <span class="number">-1</span>)</span><br><span class="line">      .map((&#123;</span><br><span class="line">        chunk,</span><br><span class="line">        hash,</span><br><span class="line">        index</span><br><span class="line">      &#125;, i) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> form = <span class="keyword">new</span> FormData();</span><br><span class="line">        form.append(<span class="string">"chunk"</span>, chunk);</span><br><span class="line">        form.append(<span class="string">"hash"</span>, hash);</span><br><span class="line">        form.append(<span class="string">"filename"</span>, <span class="keyword">this</span>.container.file.name);</span><br><span class="line">        form.append(<span class="string">"fileHash"</span>, <span class="keyword">this</span>.container.hash);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          form,</span><br><span class="line">          index</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;).map((&#123;</span><br><span class="line">          form,</span><br><span class="line">          index</span><br><span class="line">        &#125;) =&gt;</span><br><span class="line">        request(&#123;</span><br><span class="line">          url: <span class="string">"/upload"</span>,</span><br><span class="line">          data: form,</span><br><span class="line">          onProgress: <span class="keyword">this</span>.createProgresshandler(<span class="keyword">this</span>.chunks[index]),</span><br><span class="line">          requestList: <span class="keyword">this</span>.requestList</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    <span class="comment">// 直接全量并发</span></span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">Promise</span>.all(list);</span><br><span class="line">    <span class="comment">// 控制并发 </span></span><br><span class="line">    <span class="keyword">const</span> ret = <span class="keyword">await</span></span><br><span class="line">    <span class="keyword">this</span>.sendRequest(list, <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">if</span> (uploadedList.length + list.length ===</span><br><span class="line">      <span class="keyword">this</span>.chunks.length) &#123;</span><br><span class="line">      <span class="comment">// 上传和已经存在之和 等于全部的再合并</span></span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">this</span>.mergeRequest();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>2、<strong>慢启动策略</strong></p>
<p>TCP拥塞控制的问题 其实就是根据当前⽹络情况，动态</p>
<p>调整切⽚的⼤⼩</p>
<ol>
<li><p>chunk中带上size值，不过进度条数量不确定了，修改createFileChunk， 请求加上时间统计)</p>
</li>
<li><p>⽐如我们理想是30秒传递⼀个</p>
</li>
<li><p>初始⼤⼩定为1M，如果上传花了10秒，那下⼀个区块⼤⼩变成3M</p>
</li>
<li><p>如果上传花了60秒，那下⼀个区块⼤⼩变成500KB以此类推</p>
</li>
<li><p>并发+慢启动的逻辑有些复杂，我⾃⼰还没绕明⽩，囧所以先⼀次只传⼀个切⽚，来演示这个逻辑，新建⼀个handleUpload1函数</p>
</li>
</ol>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">async handleUpload1() &#123;</span><br><span class="line">    <span class="comment">// @todo数据缩放的⽐率 可以更平缓  // @todo 并发+慢启动</span></span><br><span class="line">    <span class="comment">// 慢启动上传逻辑</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">file</span> = this.container.<span class="keyword">file</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">file</span>) <span class="keyword">return</span>;</span><br><span class="line">    this.status = Status.uploading;</span><br><span class="line">    <span class="keyword">const</span> fileSize = <span class="keyword">file</span>.size</span><br><span class="line">    let offset = 1024 * 1024</span><br><span class="line">    let cur = 0</span><br><span class="line">    let <span class="keyword">count</span> = 0</span><br><span class="line">    this.container.hash = await</span><br><span class="line">    this.calculateHashSample();</span><br><span class="line">    <span class="keyword">while</span> (cur &lt; fileSize) &#123;</span><br><span class="line">      <span class="comment">// 切割offfset⼤⼩</span></span><br><span class="line">      <span class="keyword">const</span> chunk = <span class="keyword">file</span>.slice(cur, cur + offset)</span><br><span class="line">      cur += offset</span><br><span class="line">      <span class="keyword">const</span> chunkName = this.container.hash + <span class="string">"-"</span> + <span class="keyword">count</span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">form</span> = new FormData();</span><br><span class="line">      <span class="keyword">form</span>.<span class="keyword">append</span>(<span class="string">"chunk"</span>, chunk);</span><br><span class="line">      <span class="keyword">form</span>.<span class="keyword">append</span>(<span class="string">"hash"</span>, chunkName);</span><br><span class="line">      <span class="keyword">form</span>.<span class="keyword">append</span>(<span class="string">"filename"</span>, <span class="keyword">file</span>.name);</span><br><span class="line">      <span class="keyword">form</span>.<span class="keyword">append</span>(<span class="string">"fileHash"</span>, this.container.hash);</span><br><span class="line">      <span class="keyword">form</span>.<span class="keyword">append</span>(<span class="string">"size"</span>, chunk.size);</span><br><span class="line"></span><br><span class="line">      let start = new</span><br><span class="line">      <span class="built_in">Date</span>().getTime()</span><br><span class="line">      await request(&#123;</span><br><span class="line">        url: '/upload',</span><br><span class="line">        data: <span class="keyword">form</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">const</span> now = new</span><br><span class="line">      <span class="built_in">Date</span>().getTime()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> time = ((now - start) / 1000).toFixed(4)</span><br><span class="line">      let rate = time / 30</span><br><span class="line">      <span class="comment">// 速率有最⼤2和最⼩0.5</span></span><br><span class="line">      <span class="keyword">if</span> (rate &lt; 0.5) rate = 0.5</span><br><span class="line">      <span class="keyword">if</span> (rate &gt; 2) rate = 2</span><br><span class="line">      <span class="comment">// 新的切⽚⼤⼩等⽐变化</span></span><br><span class="line">      console.<span class="built_in">log</span>(`切⽚<span class="variable">$&#123;count&#125;</span>⼤⼩是<span class="variable">$&#123;this</span>.<span class="keyword">format</span>(offset)&#125;,耗时<span class="variable">$&#123;time&#125;</span>秒，是30秒的<span class="variable">$&#123;rate&#125;</span>倍，修正⼤⼩为<span class="variable">$&#123;this</span>.<span class="keyword">format</span>(offset/rate)&#125;`)</span><br><span class="line">      <span class="comment">// 动态调整offset</span></span><br><span class="line">      offset = parseInt(offset / rate)</span><br><span class="line">      <span class="comment">// if(time)</span></span><br><span class="line">      <span class="keyword">count</span>++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//切⽚0⼤⼩是1024.00KB,耗时13.2770秒，是30秒的0.5倍，修正⼤⼩为2.00MB</span></span><br><span class="line"><span class="comment">//切⽚1⼤⼩是2.00MB,耗时25.4130秒，是30秒的0.8471倍，修正⼤⼩为2.36MB</span></span><br><span class="line"><span class="comment">//切⽚2⼤⼩是2.36MB,耗时14.1260秒，是30秒的0.5倍，修正⼤⼩为4.72MB</span></span><br></pre></td></tr></table></figure>
<p>3、<strong>碎⽚清理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为了⽅便测试，我改成每5秒扫⼀次， 过期1钟的删除做演示</span></span><br><span class="line">  <span class="keyword">const</span> fse = <span class="built_in">require</span>(<span class="string">'fs-extra'</span>)</span><br><span class="line">  <span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line">  <span class="keyword">const</span> schedule = <span class="built_in">require</span>(<span class="string">'nodeschedule'</span>) <span class="comment">// 空⽬录删除</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params">file, stats</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime()</span><br><span class="line">    <span class="keyword">const</span> offset = now - stats.ctimeMs</span><br><span class="line">    <span class="keyword">if</span> (offset &gt; <span class="number">1000</span> * <span class="number">60</span>) &#123;</span><br><span class="line">      <span class="comment">// ⼤于60秒的碎⽚</span></span><br><span class="line">      <span class="built_in">console</span>.log(file, <span class="string">'过期了，浪费空间的玩意，删除'</span>)</span><br><span class="line">      fse.unlinkSync(file)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">scan</span>(<span class="params">dir, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> files = fse.readdirSync(dir)</span><br><span class="line">    files.forEach(<span class="function"><span class="params">filename</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> fileDir = path.resolve(dir, filename)</span><br><span class="line">      <span class="keyword">const</span> stats = fse.statSync(fileDir)</span><br><span class="line">      <span class="keyword">if</span> (stats.isDirectory()) &#123;</span><br><span class="line">        <span class="keyword">return</span> scan(fileDir, remove)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">        callback(fileDir, stats)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> start = <span class="function"><span class="keyword">function</span> (<span class="params">UPLOAD_DIR</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 每5秒</span></span><br><span class="line">    schedule.scheduleJob(<span class="string">"*/5 * * * * *"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'开始扫描'</span>)</span><br><span class="line">      scan(UPLOAD_DIR)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  exports.start = start</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">开始扫描</span><br><span class="line">/upload/target/<span class="number">625</span>c.../<span class="number">625</span>c...<span class="number">-0</span> 过期了，</span><br><span class="line">删除</span><br><span class="line">/upload/target/<span class="number">625</span>c.../<span class="number">625</span>c...<span class="number">-1</span> 过期了，</span><br><span class="line">删除</span><br><span class="line">/upload/target/<span class="number">625</span>c.../<span class="number">625</span>c...<span class="number">-10</span> 过期了，</span><br><span class="line">删除</span><br><span class="line">/upload/target/<span class="number">625</span>c.../<span class="number">625</span>c...<span class="number">-11</span> 过期了，</span><br><span class="line">删除</span><br><span class="line">/upload/target/<span class="number">625</span>c.../<span class="number">625</span>c...<span class="number">-12</span> 过期了，</span><br><span class="line">删除</span><br></pre></td></tr></table></figure>
<h2 id="面试题之后续问题"><a href="#面试题之后续问题" class="headerlink" title="面试题之后续问题"></a>面试题之后续问题</h2><ol>
<li>requestIdleCallback兼容性，如何⾃⼰实现⼀个<br>react也是⾃⼰写的调度逻辑,React⾃⼰实现的requestIdleCallback(<a href="https://www.dazhuanlan.com/2019/10/20/5dabc56a750fd/" target="_blank" rel="noopener">https://www.dazhuanlan.com/2019/10/20/5dabc56a750fd/</a>)</li>
<li>并发+慢启动配合</li>
<li>抽样hash+全量哈希+时间切⽚配合</li>
<li>⼤⽂件切⽚下载</li>
<li>websocket推送进度</li>
<li>⽂件碎⽚分机器存储以及⽂件碎⽚备份</li>
</ol>

        </div>
        
          


  <section class='meta' id="footer-meta">
    <hr>
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-12-22T17:30:59+08:00">
  <a class='notlink'>
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>最后更新于 2020年12月22日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/blogpost/tags/面试题/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>面试题</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://yangyfeng.github.io/posts/37eb3f8a.html&title=⼤⼚⾯试章法 | 峰享会&pics=https://s2.ax1x.com/2019/07/12/Zhm4jf.jpg&summary=简历2⻚以内，简历有点类似相亲的介绍，⼩时候拿过三好学
⽣就别说了，就像别写你会html+css，别写你⽤vue做 
过todolist⼀样
突出⾃⼰的技术亮点
别瞎写精通
markdown就好，别⽤word
突出亮点！
⽬标公司天眼查，脉脉，知乎
如何描述做过的项⽬
做过的明星项⽬

项⽬技术栈和细节

源码深度

优化，性能，体验，极客

填坑

成⻓


⾯试技巧合计
认识⾃⼰（市场）

阐述优势

谈判得来的 都是纯利润

hr细节(考勤，补贴，996，五险⼀⾦，补贴

⼀个⾯试题的精讲

精讲面试题之前端⽂件上传1、原理概述
考察全栈思维，http协议 ，node⽂件处理
我⽤vue+element+nodejs来演示
基本答案 （10K）"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://yangyfeng.github.io/posts/37eb3f8a.html&title=⼤⼚⾯试章法 | 峰享会&pics=https://s2.ax1x.com/2019/07/12/Zhm4jf.jpg&summary=简历2⻚以内，简历有点类似相亲的介绍，⼩时候拿过三好学
⽣就别说了，就像别写你会html+css，别写你⽤vue做 
过todolist⼀样
突出⾃⼰的技术亮点
别瞎写精通
markdown就好，别⽤word
突出亮点！
⽬标公司天眼查，脉脉，知乎
如何描述做过的项⽬
做过的明星项⽬

项⽬技术栈和细节

源码深度

优化，性能，体验，极客

填坑

成⻓


⾯试技巧合计
认识⾃⼰（市场）

阐述优势

谈判得来的 都是纯利润

hr细节(考勤，补贴，996，五险⼀⾦，补贴

⼀个⾯试题的精讲

精讲面试题之前端⽂件上传1、原理概述
考察全栈思维，http协议 ，node⽂件处理
我⽤vue+element+nodejs来演示
基本答案 （10K）"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://yangyfeng.github.io/posts/37eb3f8a.html&title=⼤⼚⾯试章法 | 峰享会&pics=https://s2.ax1x.com/2019/07/12/Zhm4jf.jpg&summary=简历2⻚以内，简历有点类似相亲的介绍，⼩时候拿过三好学
⽣就别说了，就像别写你会html+css，别写你⽤vue做 
过todolist⼀样
突出⾃⼰的技术亮点
别瞎写精通
markdown就好，别⽤word
突出亮点！
⽬标公司天眼查，脉脉，知乎
如何描述做过的项⽬
做过的明星项⽬

项⽬技术栈和细节

源码深度

优化，性能，体验，极客

填坑

成⻓


⾯试技巧合计
认识⾃⼰（市场）

阐述优势

谈判得来的 都是纯利润

hr细节(考勤，补贴，996，五险⼀⾦，补贴

⼀个⾯试题的精讲

精讲面试题之前端⽂件上传1、原理概述
考察全栈思维，http协议 ，node⽂件处理
我⽤vue+element+nodejs来演示
基本答案 （10K）"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
      
        <a class='qrcode' rel="external nofollow noopener noreferrer" href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJElEQVR42u3aQW7DMAwEwPz/0+m1QBNnScYFJI1PheE6Gh8WEsnHI76erev3/16/+e+vPO64MDAwlmXkS7njzrs15GvDwMA4h5FE4Xxx189c/+6HNWNgYGDEjN6TCQkDAwOjypicMfNDLAYGBkb1EJuE5jxYbz+LY2BgLMjI4/L//76lv4GBgbEUo9eSTEpp1RZmHrIvfhEDA2NrRh5w1XGKyZ3qejAwMPZm5AMWyZF1vuikJPfiDgYGxgGMyVLmjYF5yQ8DA2NvRlLKT7Zr+fPz4C6X3jAwMBZnVLdi+caxuuHLD7QfqoYYGBjbMfLorA5YVO9MwBgYGHsz8jhrHinjiMx3si/WgIGBsTUjB/QCsRfZvSjHwMA4gdELvnxZOaZKwsDA2JuRvDo5BxfGTIMYLX9cDAyMrRn5S+9rAExGPT7scDEwMLZgTAKx2s6sbh8LuYqBgXEAo7pRmw9h9MYsov4GBgbGdoxkudVS/qQtmhf1opELDAyM7RjfKpDNB8iqQx4YGBinMZKlVItuvUCvtjwxMDBOYFRHJe4I3LxHiYGBcQ7jWbyqEZmX6nqfDAMD4wRGfs1fWj0qJ4MaZRgGBsayjDxkq1/iW8fX0XfCwMDYiNELvuulVFuVvY+OgYGBkW/ReiNfeUkuKrphYGBgBHHZawbk29CvBS4GBsaCjLwZcH0/GbyYRPbb92BgYGzN6NWyesOmSXvgxqYmBgbGeowfnEhqmKwxP+sAAAAASUVORK5CYII='>
        
          <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/wechat.png">
        
        </a>
      
    
      
        <a class='qrcode' rel="external nofollow noopener noreferrer" href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJElEQVR42u3aQW7DMAwEwPz/0+m1QBNnScYFJI1PheE6Gh8WEsnHI76erev3/16/+e+vPO64MDAwlmXkS7njzrs15GvDwMA4h5FE4Xxx189c/+6HNWNgYGDEjN6TCQkDAwOjypicMfNDLAYGBkb1EJuE5jxYbz+LY2BgLMjI4/L//76lv4GBgbEUo9eSTEpp1RZmHrIvfhEDA2NrRh5w1XGKyZ3qejAwMPZm5AMWyZF1vuikJPfiDgYGxgGMyVLmjYF5yQ8DA2NvRlLKT7Zr+fPz4C6X3jAwMBZnVLdi+caxuuHLD7QfqoYYGBjbMfLorA5YVO9MwBgYGHsz8jhrHinjiMx3si/WgIGBsTUjB/QCsRfZvSjHwMA4gdELvnxZOaZKwsDA2JuRvDo5BxfGTIMYLX9cDAyMrRn5S+9rAExGPT7scDEwMLZgTAKx2s6sbh8LuYqBgXEAo7pRmw9h9MYsov4GBgbGdoxkudVS/qQtmhf1opELDAyM7RjfKpDNB8iqQx4YGBinMZKlVItuvUCvtjwxMDBOYFRHJe4I3LxHiYGBcQ7jWbyqEZmX6nqfDAMD4wRGfs1fWj0qJ4MaZRgGBsayjDxkq1/iW8fX0XfCwMDYiNELvuulVFuVvY+OgYGBkW/ReiNfeUkuKrphYGBgBHHZawbk29CvBS4GBsaCjLwZcH0/GbyYRPbb92BgYGzN6NWyesOmSXvgxqYmBgbGeowfnEhqmKwxP+sAAAAASUVORK5CYII='>
        
          <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qrcode.png">
        
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
            <div class="prev-next">
                
                    <section class="prev">
                        <span class="art-item-left">
                            <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                            <h4>
                                <a href="/posts/138dbef8.html" rel="prev" title="什么是PWA">
                                  
                                      什么是PWA
                                  
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/blogpost/tags/前端工程化/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>前端工程化</a>
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/posts/e4aa7462.html" rel="prev" title="NodeJs中数据库的使用">
                                    
                                        NodeJs中数据库的使用
                                    
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/blogpost/tags/Node/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>Node</a>
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: '⼤⼚⾯试章法',
      tools: true
    }
  </script>

<!-- gittalk -->

  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<div id="gitalk-container" style="margin: 0 5px;"></div>
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: 'c9d3bfe9137dc2038a1a',
    clientSecret: '1ecb6999a152dad80e08c672ac5a779b92eb6ec0',
    id: window.location.pathname,
    repo: 'yangyfeng.github.io',
    owner: 'yangyfeng',
    admin: 'yangyfeng'
  })
  gitalk.render('gitalk-container')
</script>

</div>
<aside class='l_side'>
  
    
    
      
        
          
          
            <section class='widget author'>
  <div class='content material'>
    
      <div class='avatar' style="position: relative;">
        <a style="position: absolute;right: 0;top: 0;z-index: 2" href="https://github.com/yangyfeng" target="_blank" class="github-corner" aria-label="View source on Github">
          <svg width="92" height="92" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg>
        </a>
        <img class='avatar' src='https://s2.ax1x.com/2019/07/12/Zhm4jf.jpg'/>
      </div>
    
    
      <div class='text'>
        
          <h2>漫道求索</h2>
        
        
          <p><span data-chakhsu data-chakhsu-text="每写一行代码，都是人类的一次进步">每写一行代码，都是人类的一次进步</span></p>

        
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="mailto:yangyufeng.web@foxmail.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://segmentfault.com/u/yangyufeng"
              class="social fas fa-link flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://blog.csdn.net/qq_35676160"
              class="social fa fa-paper-plane flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://tool.lu/"
              class="social fas fa-toolbox flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

          
        
      
        
          
          
            
  <section class='widget toc-wrapper'>
    
<header class='material'>
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
  
    <div class='wrapper'><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div>
  
</header>

    <div class='content material'>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简历"><span class="toc-text">简历</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#⽬标公司"><span class="toc-text">⽬标公司</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何描述做过的项⽬"><span class="toc-text">如何描述做过的项⽬</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#⾯试技巧合计"><span class="toc-text">⾯试技巧合计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#精讲面试题之前端⽂件上传"><span class="toc-text">精讲面试题之前端⽂件上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#精讲面试题之请求并发数控制和重试"><span class="toc-text">精讲面试题之请求并发数控制和重试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#面试题之后续问题"><span class="toc-text">面试题之后续问题</span></a></li></ol>
    </div>
  </section>


          
        
      
        
          
          
            <section class='widget grid'>
  
<header class='material'>
  <div><i class="fas fa-map-signs fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;站内导航</div>
  
</header>

  <div class='content material'>
    <ul class="grid navgation">
      
        <li><a class="flat-box" title="/" href="/"
          
          
          id="home">
          
            <i class="fas fa-clock fa-fw" aria-hidden="true"></i>
          
          所有文章
        </a></li>
      
        <li><a class="flat-box" title="/blogpost/archives/" href="/blogpost/archives/"
          
            rel="nofollow"
          
          
          id="blogpostarchives">
          
            <i class="fas fa-archive fa-fw" aria-hidden="true"></i>
          
          文章归档
        </a></li>
      
        <li><a class="flat-box" title="/blogpost/tags/" href="/blogpost/tags/"
          
            rel="nofollow"
          
          
          id="blogposttags">
          
            <i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>
          
          所有标签
        </a></li>
      
        <li><a class="flat-box" title="/friends/" href="/friends/"
          
            rel="nofollow"
          
          
          id="friends">
          
            <i class="fas fa-link fa-fw" aria-hidden="true"></i>
          
          我的友链
        </a></li>
      
        <li><a class="flat-box" title="/./atom.xml" href="/./atom.xml"
          
            rel="nofollow"
          
          
          id=".atom.xml">
          
            <i class="fas fa-rss fa-fw" aria-hidden="true"></i>
          
          RSS订阅
        </a></li>
      
        <li><a class="flat-box" title="/about/" href="/about/"
          
            rel="nofollow"
          
          
          id="about">
          
            <i class="fas fa-info-circle fa-fw" aria-hidden="true"></i>
          
          关于博主
        </a></li>
      
    </ul>
  </div>
</section>

          
        
      
        
          
          
            
  <section class='widget category'>
    
<header class='material'>
  <div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;文章分类</div>
  
    <a class="rightBtn"
    
      rel="nofollow"
    
    
    href="/blogpost/categories/"
    title="blogpost/categories/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class='content material'>
      <ul class="entry">
        
          <li><a class="flat-box" title="/blogpost/categories/个人项目/" href="/blogpost/categories/个人项目/"><div class='name'>个人项目</div><div class='badge'>(7)</div></a></li>
        
          <li><a class="flat-box" title="/blogpost/categories/前端/" href="/blogpost/categories/前端/"><div class='name'>前端</div><div class='badge'>(26)</div></a></li>
        
          <li><a class="flat-box" title="/blogpost/categories/博客文档/" href="/blogpost/categories/博客文档/"><div class='name'>博客文档</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box" title="/blogpost/categories/后端/" href="/blogpost/categories/后端/"><div class='name'>后端</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box" title="/blogpost/categories/开发工具/" href="/blogpost/categories/开发工具/"><div class='name'>开发工具</div><div class='badge'>(6)</div></a></li>
        
          <li><a class="flat-box" title="/blogpost/categories/深入前端/" href="/blogpost/categories/深入前端/"><div class='name'>深入前端</div><div class='badge'>(8)</div></a></li>
        
      </ul>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class='widget tagcloud'>
    
<header class='material'>
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;热门标签</div>
  
    <a class="rightBtn"
    
      rel="nofollow"
    
    
    href="/blogpost/tags/"
    title="blogpost/tags/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class='content material'>
      <a href="/blogpost/tags/Create-React-App/" style="font-size: 16px; color: #8b8b8b">Create-React-App</a> <a href="/blogpost/tags/Devops/" style="font-size: 14px; color: #999">Devops</a> <a href="/blogpost/tags/Es6/" style="font-size: 16px; color: #8b8b8b">Es6</a> <a href="/blogpost/tags/EventLoop/" style="font-size: 14px; color: #999">EventLoop</a> <a href="/blogpost/tags/Excel/" style="font-size: 14px; color: #999">Excel</a> <a href="/blogpost/tags/Git/" style="font-size: 16px; color: #8b8b8b">Git</a> <a href="/blogpost/tags/GoLang/" style="font-size: 14px; color: #999">GoLang</a> <a href="/blogpost/tags/Http/" style="font-size: 18px; color: #7e7e7e">Http</a> <a href="/blogpost/tags/JS运行原理/" style="font-size: 18px; color: #7e7e7e">JS运行原理</a> <a href="/blogpost/tags/Javascript/" style="font-size: 18px; color: #7e7e7e">Javascript</a> <a href="/blogpost/tags/Less/" style="font-size: 14px; color: #999">Less</a> <a href="/blogpost/tags/Node/" style="font-size: 16px; color: #8b8b8b">Node</a> <a href="/blogpost/tags/React/" style="font-size: 18px; color: #7e7e7e">React</a> <a href="/blogpost/tags/V8引擎/" style="font-size: 14px; color: #999">V8引擎</a> <a href="/blogpost/tags/VsCode/" style="font-size: 16px; color: #8b8b8b">VsCode</a> <a href="/blogpost/tags/Vue/" style="font-size: 24px; color: #555">Vue</a> <a href="/blogpost/tags/Webpack/" style="font-size: 16px; color: #8b8b8b">Webpack</a> <a href="/blogpost/tags/代码优化/" style="font-size: 14px; color: #999">代码优化</a> <a href="/blogpost/tags/前端/" style="font-size: 22px; color: #636363">前端</a> <a href="/blogpost/tags/前端工程化/" style="font-size: 20px; color: #707070">前端工程化</a> <a href="/blogpost/tags/开发工具/" style="font-size: 16px; color: #8b8b8b">开发工具</a> <a href="/blogpost/tags/性能优化/" style="font-size: 14px; color: #999">性能优化</a> <a href="/blogpost/tags/插件/" style="font-size: 14px; color: #999">插件</a> <a href="/blogpost/tags/数据可视化/" style="font-size: 20px; color: #707070">数据可视化</a> <a href="/blogpost/tags/模块化/" style="font-size: 14px; color: #999">模块化</a> <a href="/blogpost/tags/浏览器运行原理/" style="font-size: 14px; color: #999">浏览器运行原理</a> <a href="/blogpost/tags/面试题/" style="font-size: 22px; color: #636363">面试题</a>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class='widget related_posts'>
    
<header class='material'>
  <div><i class="fas fa-bookmark fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;相关文章</div>
  
</header>

    <div class="content material">
      <ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\posts\13437c1d.html" title="React知识点集合" rel="bookmark">React知识点集合</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\posts\f0a558a1.html" title="vue面试题（1）" rel="bookmark">vue面试题（1）</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\posts\714f78f3.html" title="面试题集锦（1）" rel="bookmark">面试题集锦（1）</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\posts\5b9a2dd2.html" title="Vue知识点集合" rel="bookmark">Vue知识点集合</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\posts\e210f74f.html" title="vue面试题（2）" rel="bookmark">vue面试题（2）</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\posts\63fad71d.html" title="面试题集锦（2）" rel="bookmark">面试题集锦（2）</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\posts\8136685c.html" title="less在vue中的使用" rel="bookmark">less在vue中的使用</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\posts\390a51fc.html" title="Babel转码器" rel="bookmark">Babel转码器</a></h3></div></li></ul>
    </div>
  </section>


          
        
      
        
          
          
            


  <section class='widget music'>
    
<header class='material'>
  <div><i class="fas fa-compact-disc fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;最近在听</div>
  
    <a class="rightBtn"
    
      rel="external nofollow noopener noreferrer"
    
    
      target="_blank"
    
    href="https://music.163.com/#/user/home?id=629541737"
    title="https://music.163.com/#/user/home?id=629541737">
    <i class="far fa-heart fa-fw"></i></a>
  
</header>

    <div class='content material'>
      
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.css">
  <div class="aplayer"
    data-theme="#242424"
    
    
    data-mode="circulation"
    data-server="netease"
    data-type="playlist"
    data-id="2868600326"
    data-volume="0.7">
  </div>
  <script src="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>


    </div>
  </section>


          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="mailto:yangyufeng.web@foxmail.com" class="social fas fa-envelope flat-btn" target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://segmentfault.com/u/yangyufeng" class="social fas fa-link flat-btn" target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://blog.csdn.net/qq_35676160" class="social fa fa-paper-plane flat-btn" target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://tool.lu/" class="social fas fa-toolbox flat-btn" target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <!-- 统计 -->
  <div class="total-count">
    <!-- 访问量 -->
    
      <span>
        <b class="fas fa-chart-line"></b>
        总计访问：<span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>次
      </span>
    
    <!-- 文章字体个数 -->
    
      <span>
        <b class="fas fa-database"></b>
        本站字数：<span class="post-count">67.5k</span>
      </span>
    
    <!-- 网站运行时间 -->
    <span>
      <b class="fas fa-calendar-day"></b>
      网站运行时间：<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
    </span>
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>
<script>
  var now = new Date();
  function createtime() {
    //在此处修改你的建站时间
    var grt = new Date("07/01/2019 00:00:00");
    now.setTime(now.getTime() + 250);
    days = (now - grt) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
    hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
    if (String(hnum).length == 1) { hnum = "0" + hnum; } minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum);
    mnum = Math.floor(minutes); if (String(mnum).length == 1) { mnum = "0" + mnum; }
    seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
    snum = Math.round(seconds); if (String(snum).length == 1) { snum = "0" + snum; }
    document.getElementById("timeDate").innerHTML = dnum + " 天 ";
    document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
  }
  setInterval("createtime()", 250);
</script>

      <!-- 会动的小人 -->
      <!-- <div id="spig" class="spig">
        <div id="message">加载中……</div>
        <div id="mumu" class="mumu"></div>
      </div> -->
      <!-- 樱花资源 -->
      <canvas id="sakura"></canvas>
      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/TRHX/CDN-for-itrhx.com@2.0.2/js/instantclick-1.2.2.js" type="module"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>


  <!-- fastclick -->
  <script src="https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      FastClick.attach(document.body)
    }, false)
  </script>



  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/img/gb3.jpg"],
          {
            duration: "60000",
            fade: "1000"
          });
        } else {
          $.backstretch(
          ["https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/img/gb3.jpg"],
          {
            duration: "60000",
            fade: "1000"
          });
        }
      });
    </script>
  











  <script src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/js/app.js"></script>


  <script src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "[object Object]";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
  <!-- 浮动小人 -->
  <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/js/sipng.js"></script> -->
  <!-- 页面点击小红心 -->
  <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/js/love.js"></script> -->
  <!--动态线条背景-->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/js/canvas-nest.min.js" color="111,111,111" opacity='0.65' zIndex="-10" count="120" ></script>
  <!-- 飘动丝带 -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/js/piao.js" ></script>
  <!-- 跳动的字 -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/js/chakhsu.js" ></script>
  <!-- 樱花飘落 -->
  <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/js/sakura.js" ></script> -->
  <!-- 人体时钟背景透明 -->
  <!-- <script type="text/javascript" charset="Shift_JIS" src="https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/js/clock.js"></script> -->
  <!-- 浏览器搞笑标题 -->
  <script type="text/javascript" id="bowerTitle">
    var OriginTitle = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
      if (document.hidden) {
        $('[rel="shortcut icon"]').attr('href', "https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/img/error_favicon.ico");
        document.title = '你的页面走丢了...';
        clearTimeout(titleTime);
      } else {
        $('[rel="shortcut icon"]').attr('href', "https://cdn.jsdelivr.net/gh/yangyfeng/yangyfeng.github.io@gh-pages/assets_blog/img/favicon.ico");
        document.title = '欢迎回来!'
        titleTime = setTimeout(function () {
          document.title = OriginTitle;
        }, 1000)
      }
    });
  </script>
  <!-- 樱花资源 -->
  <script id="sakura_point_vsh" type="x-shader/x_vertex">
    uniform mat4 uProjection;
    uniform mat4 uModelview;
    uniform vec3 uResolution;
    uniform vec3 uOffset;
    uniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius
    uniform vec3 uFade; //x:start distance, y:half distance, z:near fade start
    
    attribute vec3 aPosition;
    attribute vec3 aEuler;
    attribute vec2 aMisc; //x:size, y:fade
    
    varying vec3 pposition;
    varying float psize;
    varying float palpha;
    varying float pdist;
    
    //varying mat3 rotMat;
    varying vec3 normX;
    varying vec3 normY;
    varying vec3 normZ;
    varying vec3 normal;
    
    varying float diffuse;
    varying float specular;
    varying float rstop;
    varying float distancefade;
    
    void main(void) {
    // Projection is based on vertical angle
    vec4 pos = uModelview * vec4(aPosition + uOffset, 1.0);
    gl_Position = uProjection * pos;
    gl_PointSize = aMisc.x * uProjection[1][1] / -pos.z * uResolution.y * 0.5;
    
    pposition = pos.xyz;
    psize = aMisc.x;
    pdist = length(pos.xyz);
    palpha = smoothstep(0.0, 1.0, (pdist - 0.1) / uFade.z);
    
    vec3 elrsn = sin(aEuler);
    vec3 elrcs = cos(aEuler);
    mat3 rotx = mat3(
    1.0, 0.0, 0.0,
    0.0, elrcs.x, elrsn.x,
    0.0, -elrsn.x, elrcs.x
    );
    mat3 roty = mat3(
    elrcs.y, 0.0, -elrsn.y,
    0.0, 1.0, 0.0,
    elrsn.y, 0.0, elrcs.y
    );
    mat3 rotz = mat3(
    elrcs.z, elrsn.z, 0.0, 
    -elrsn.z, elrcs.z, 0.0,
    0.0, 0.0, 1.0
    );
    mat3 rotmat = rotx * roty * rotz;
    normal = rotmat[2];
    
    mat3 trrotm = mat3(
    rotmat[0][0], rotmat[1][0], rotmat[2][0],
    rotmat[0][1], rotmat[1][1], rotmat[2][1],
    rotmat[0][2], rotmat[1][2], rotmat[2][2]
    );
    normX = trrotm[0];
    normY = trrotm[1];
    normZ = trrotm[2];
    
    const vec3 lit = vec3(0.6917144638660746, 0.6917144638660746, -0.20751433915982237);
    
    float tmpdfs = dot(lit, normal);
    if(tmpdfs < 0.0) {
    normal = -normal;
    tmpdfs = dot(lit, normal);
    }
    diffuse = 0.4 + tmpdfs;
    
    vec3 eyev = normalize(-pos.xyz);
    if(dot(eyev, normal) > 0.0) {
    vec3 hv = normalize(eyev + lit);
    specular = pow(max(dot(hv, normal), 0.0), 20.0);
    }
    else {
    specular = 0.0;
    }
    
    rstop = clamp((abs(pdist - uDOF.x) - uDOF.y) / uDOF.z, 0.0, 1.0);
    rstop = pow(rstop, 0.5);
    //-0.69315 = ln(0.5)
    distancefade = min(1.0, exp((uFade.x - pdist) * 0.69315 / uFade.y));
    }
  </script>
  <script id="sakura_point_fsh" type="x-shader/x_fragment">
    #ifdef GL_ES
    //precision mediump float;
    precision highp float;
    #endif
    
    uniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius
    uniform vec3 uFade; //x:start distance, y:half distance, z:near fade start
    
    const vec3 fadeCol = vec3(0.08, 0.03, 0.06);
    
    varying vec3 pposition;
    varying float psize;
    varying float palpha;
    varying float pdist;
    
    //varying mat3 rotMat;
    varying vec3 normX;
    varying vec3 normY;
    varying vec3 normZ;
    varying vec3 normal;
    
    varying float diffuse;
    varying float specular;
    varying float rstop;
    varying float distancefade;
    
    float ellipse(vec2 p, vec2 o, vec2 r) {
    vec2 lp = (p - o) / r;
    return length(lp) - 1.0;
    }
    
    void main(void) {
    vec3 p = vec3(gl_PointCoord - vec2(0.5, 0.5), 0.0) * 2.0;
    vec3 d = vec3(0.0, 0.0, -1.0);
    float nd = normZ.z; //dot(-normZ, d);
    if(abs(nd) < 0.0001) discard;
    
    float np = dot(normZ, p);
    vec3 tp = p + d * np / nd;
    vec2 coord = vec2(dot(normX, tp), dot(normY, tp));
    
    //angle = 15 degree
    const float flwrsn = 0.258819045102521;
    const float flwrcs = 0.965925826289068;
    mat2 flwrm = mat2(flwrcs, -flwrsn, flwrsn, flwrcs);
    vec2 flwrp = vec2(abs(coord.x), coord.y) * flwrm;
    
    float r;
    if(flwrp.x < 0.0) {
    r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.36, 0.96) * 0.5);
    }
    else {
    r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.58, 0.96) * 0.5);
    }
    
    if(r > rstop) discard;
    
    vec3 col = mix(vec3(1.0, 0.8, 0.75), vec3(1.0, 0.9, 0.87), r);
    float grady = mix(0.0, 1.0, pow(coord.y * 0.5 + 0.5, 0.35));
    col *= vec3(1.0, grady, grady);
    col *= mix(0.8, 1.0, pow(abs(coord.x), 0.3));
    col = col * diffuse + specular;
    
    col = mix(fadeCol, col, distancefade);
    
    float alpha = (rstop > 0.001)? (0.5 - r / (rstop * 2.0)) : 1.0;
    alpha = smoothstep(0.0, 1.0, alpha) * palpha;
    
    gl_FragColor = vec4(col * 0.5, alpha);
    }
  </script>
  <!-- effects -->
  <script id="fx_common_vsh" type="x-shader/x_vertex">
    uniform vec3 uResolution;
    attribute vec2 aPosition;
    
    varying vec2 texCoord;
    varying vec2 screenCoord;
    
    void main(void) {
    gl_Position = vec4(aPosition, 0.0, 1.0);
    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);
    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);
    }
  </script>
  <script id="bg_fsh" type="x-shader/x_fragment">
    #ifdef GL_ES
    //precision mediump float;
    precision highp float;
    #endif
    
    uniform vec2 uTimes;
    
    varying vec2 texCoord;
    varying vec2 screenCoord;
    
    void main(void) {
    vec3 col;
    float c;
    vec2 tmpv = texCoord * vec2(0.8, 1.0) - vec2(0.95, 1.0);
    c = exp(-pow(length(tmpv) * 1.8, 2.0));
    col = mix(vec3(0.02, 0.0, 0.03), vec3(0.96, 0.98, 1.0) * 1.5, c);
    gl_FragColor = vec4(col * 0.5, 1.0);
    }
  </script>
  <script id="fx_brightbuf_fsh" type="x-shader/x_fragment">
    #ifdef GL_ES
    //precision mediump float;
    precision highp float;
    #endif
    uniform sampler2D uSrc;
    uniform vec2 uDelta;
    
    varying vec2 texCoord;
    varying vec2 screenCoord;
    
    void main(void) {
    vec4 col = texture2D(uSrc, texCoord);
    gl_FragColor = vec4(col.rgb * 2.0 - vec3(0.5), 1.0);
    }
  </script>
  <script id="fx_dirblur_r4_fsh" type="x-shader/x_fragment">
    #ifdef GL_ES
    //precision mediump float;
    precision highp float;
    #endif
    uniform sampler2D uSrc;
    uniform vec2 uDelta;
    uniform vec4 uBlurDir; //dir(x, y), stride(z, w)
    
    varying vec2 texCoord;
    varying vec2 screenCoord;
    
    void main(void) {
    vec4 col = texture2D(uSrc, texCoord);
    col = col + texture2D(uSrc, texCoord + uBlurDir.xy * uDelta);
    col = col + texture2D(uSrc, texCoord - uBlurDir.xy * uDelta);
    col = col + texture2D(uSrc, texCoord + (uBlurDir.xy + uBlurDir.zw) * uDelta);
    col = col + texture2D(uSrc, texCoord - (uBlurDir.xy + uBlurDir.zw) * uDelta);
    gl_FragColor = col / 5.0;
    }
  </script>
  <!-- effect fragment shader template -->
  <script id="fx_common_fsh" type="x-shader/x_fragment">
    #ifdef GL_ES
    //precision mediump float;
    precision highp float;
    #endif
    uniform sampler2D uSrc;
    uniform vec2 uDelta;
    
    varying vec2 texCoord;
    varying vec2 screenCoord;
    
    void main(void) {
    gl_FragColor = texture2D(uSrc, texCoord);
    }
  </script>
  <!-- post processing -->
  <script id="pp_final_vsh" type="x-shader/x_vertex">
    uniform vec3 uResolution;
    attribute vec2 aPosition;
    varying vec2 texCoord;
    varying vec2 screenCoord;
    void main(void) {
    gl_Position = vec4(aPosition, 0.0, 1.0);
    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);
    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);
    }
  </script>
  <script id="pp_final_fsh" type="x-shader/x_fragment">
    #ifdef GL_ES
    //precision mediump float;
    precision highp float;
    #endif
    uniform sampler2D uSrc;
    uniform sampler2D uBloom;
    uniform vec2 uDelta;
    varying vec2 texCoord;
    varying vec2 screenCoord;
    void main(void) {
    vec4 srccol = texture2D(uSrc, texCoord) * 2.0;
    vec4 bloomcol = texture2D(uBloom, texCoord);
    vec4 col;
    col = srccol + bloomcol * (vec4(1.0) + srccol);
    col *= smoothstep(1.0, 0.0, pow(length((texCoord - vec2(0.5)) * 2.0), 1.2) * 0.5);
    col = pow(col, vec4(0.45454545454545)); //(1.0 / 2.2)
    
    gl_FragColor = vec4(col.rgb, 1.0);
    gl_FragColor.a = 1.0;
    }
  </script>
<script>!function(e){var r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function t(){for(var c=0;c<r.length;c++)t=r[c],void 0,0<=(n=t.getBoundingClientRect()).top&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=r[c];t=o,n=function(){r=r.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}t(),e.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(t,e)})}(this);</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":false,"scale":0.7},"log":false});</script></body>
</html>
